// const sgMail = require("@sendgrid/mail");
// const fs = require('fs');
const nodeEmailer = require("nodemailer");
import logger from "../../services/logger";

// const setApiKey = async () => {
//     const key = process.env.sendGrid;
//     sgMail.setApiKey(key);
// }

// setApiKey()

// const getFileContent = (template_content) => {
//     let contents = fs.readFileSync(`assets/mails/${template_content.template_name}`, 'utf-8');
//     return contents;
// }

const templates = [
  {
    template_name: "DetectedHeatStress.html",
    html: '<!DOCTYPE html><html lang="en">  <head>    <meta charset="UTF-8" />    <meta http-equiv="X-UA-Compatible" content="IE=edge" />    <meta name="viewport" content="width=device-width, initial-scale=1.0" />    <title>Document</title>    <style>        .font-lato {            font-family: \'Lato\', sans-serif;        }        .font-montserrat{            font-family: \'Montserrat\', sans-serif        }        .text-col{             color : #473766        }        .justify{            text-align: justify;        }    </style>    <link    href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap"    rel="stylesheet"    type="text/css"  />  <link    href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap"    rel="stylesheet"    type="text/css"  />  </head>  <body style="background-color: rgb(249, 244, 251);">    <center>        <div style="background-color: white; padding : 1rem; border-radius: 1rem; width: calc(560px);">            <div style="background-color: rgb(247, 249, 250); padding:1rem; border-radius: 1rem; width : calc(520px);">                <table        cellpadding="0"        cellspacing="0"        border="0"        width="100%"        style="          width: calc(500px);          border-radius: 1rem;          border-collapse: collapse;          margin: 0 auto;          background-color: white;          padding: 0;          overflow: hidden;        "      >        <tbody>          <tr style="border-collapse: collapse; margin: 0; padding: 0">            <td              width="100%"              style="border-collapse: collapse; margin: 0; padding: 0"            >              <table                width="100%"                cellpadding="0"                cellspacing="0"                border="0"                style="                  min-width: 100%;                  border-collapse: collapse;                  margin: 0;                  padding: 0;                "              >                <tbody>                  <tr style="font-family: helvetica, sans-serif;                  font-weight: 100;                  text-decoration: none;                  color: #333333;                  font-size: 24px;                  border-collapse: collapse; margin: 0; padding: 0">                    <td                      width="100%"                      style="                        min-width: 100%;                        border-collapse: collapse;                        margin: 0;                        padding: 0;                      "                    >                        <div style="margin: 0px 0px 30px 0px">                            <div style="margin: 0px 0px 30px 0px">                                <img src="https://cdn.discordapp.com/attachments/955281529481883729/1020180084507811840/Pink_And_Green_Simple_Gradient_Email_Marketing_Carousel_Instagram_Post_4.png"                                 style="width: 100%;" ></img>                            </div>                            <div style="margin : 0px 20px 0px 20px">                                <p class="text-col font-lato" style="font-size: 1.5rem; font-weight: bold; "><span style="font-weight: lighter;">Hi</span> ${user_name}</p>                                                        <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">There\'s <span style="font-weight: 900;">${heat_stress_count}</span> heat stressed pig detected on <span style="font-weight: 900;">${server_name} @ ${ip} (${url})</span>. Don\'t worry as the system will automatically look for the actions that is defined by you or other admin to lower the pig temperature back to normal. <br><br>The system found and currently performing <span style="font-weight: 900;">${action_count}</span> actions to resolve the problem. You can add more actions in the <span style="font-weight: 900;"> Settings > Actions</span> page.</p>                                                        <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 900; margin-top : 2rem"> Detection ID : <span style="font-weight: 500;">${detection_id}</span> <br> Event Date & Time : <span style="font-weight: 500;">${time_string}</span> </p>                                                                </div>                        </div>                                          </td>                  </tr>                </tbody>              </table>            </td>          </tr>        </tbody>                </table>                <center>                    <table                      cellpadding="0"                      cellspacing="0"                      style="                        border-collapse: collapse;                        font-size: 13px;                        font-family: helvetica, sans-serif;                        line-height: 30px;                        border-spacing: 0px;                        width: 100%;                        margin-top: 2rem;                        width: calc(340px);                        padding: 0;                      "                    >                      <tbody>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                          "                        >                          <td                            align="center"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            padding: 5;                            border-radius: 2%;                            "                          >                                                          <p                                style="                                  font-family: helvetica, sans-serif;                                  text-decoration: none;                                  color: #383838;                                  font-size: 13px;                                  opacity: 0.7;                                  line-height: 1.5rem;                                  margin: 0;                                  padding: 0;                                "                              >                              You are receiving this notification because you set your account settings to notify you. You can always <span style="font-weight: bold;">turn off</span> this on your <span style="font-weight: bold;">account settings</span></p>                                                            </p>                          </td>                        </tr>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                            padding: 0;                          "                        >                          <td                            align="center"                            width="50"                            height="50"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            "                          >                            <img                              src="https://cdn.discordapp.com/attachments/955281529481883729/1020135329635774494/pig.png"                              alt="hero-image"                              width="40"                              height="40"                            />                          </td>                        </tr>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                          "                        >                          <td                            align="center"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            padding: 5;                            border-radius: 2%;                            "                          >                                                          <p                              class="text-col font-lato"                                style="                                  text-decoration: none;                                  font-size: 13px;                                  opacity : 0.7;                                  font-weight: 500;                                  color : #333333;                                  margin: 0;                                  padding: 0;                                "                              >                              PHS System â€¢ OLFU QC,  Philippines</p>                                                            </p>                          </td>                        </tr>                                                                      </tbody>                    </table>                </center>            </div>        </div>    </center>  </body></html>',
  },
  {
    template_name: "EnabledNotification.html",
    html: '<!DOCTYPE html><html lang="en">  <head>    <meta charset="UTF-8" />    <meta http-equiv="X-UA-Compatible" content="IE=edge" />    <meta name="viewport" content="width=device-width, initial-scale=1.0" />    <title>Document</title>    <style>        .font-lato {            font-family: \'Lato\', sans-serif;        }        .font-montserrat{            font-family: \'Montserrat\', sans-serif        }        .text-col{             color : #473766        }        .justify{            text-align: justify;        }    </style>    <link    href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap"    rel="stylesheet"    type="text/css"  />  <link    href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap"    rel="stylesheet"    type="text/css"  />  </head>  <body style="background-color: rgb(249, 244, 251);">    <center>        <div style="background-color: white; padding : 1rem; border-radius: 1rem; width: calc(560px);">            <div style="background-color: rgb(247, 249, 250); padding:1rem; border-radius: 1rem; width : calc(520px);">                <table        cellpadding="0"        cellspacing="0"        border="0"        width="100%"        style="          width: calc(500px);          border-radius: 1rem;          border-collapse: collapse;          margin: 0 auto;          background-color: white;          padding: 0;          overflow: hidden;        "      >        <tbody>          <tr style="border-collapse: collapse; margin: 0; padding: 0">            <td              width="100%"              style="border-collapse: collapse; margin: 0; padding: 0"            >              <table                width="100%"                cellpadding="0"                cellspacing="0"                border="0"                style="                  min-width: 100%;                  border-collapse: collapse;                  margin: 0;                  padding: 0;                "              >                <tbody>                  <tr style="font-family: helvetica, sans-serif;                  font-weight: 100;                  text-decoration: none;                  color: #333333;                  font-size: 24px;                  border-collapse: collapse; margin: 0; padding: 0">                    <td                      width="100%"                      style="                        min-width: 100%;                        border-collapse: collapse;                        margin: 0;                        padding: 0;                      "                    >                        <div style="margin: 0px 0px 30px 0px">                            <div style="margin: 0px 0px 30px 0px">                                <img src="https://cdn.discordapp.com/attachments/955281529481883729/1020137807123062844/Pink_And_Green_Simple_Gradient_Email_Marketing_Carousel_Instagram_Post.png"                                 style="width: 100%;" ></img>                            </div>                            <div style="margin : 0px 20px 0px 20px">                                <p class="text-col font-lato" style="font-size: 1.5rem; font-weight: bold; "><span style="font-weight: lighter;">Hi</span> ${user_name}</p>                                                        <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">You will now recieve notifications from the PHS system <span style="font-weight : 900"> ${server_name} @ ${ip} (${url})</span> you owned. If the system is not connected to the internet, notification will not be sent to you. You can always disable notification to your account on your account settings.</p>                            </div>                        </div>                                          </td>                  </tr>                </tbody>              </table>            </td>          </tr>        </tbody>                </table>                <center>                    <table                      cellpadding="0"                      cellspacing="0"                      style="                        border-collapse: collapse;                        font-size: 13px;                        font-family: helvetica, sans-serif;                        line-height: 30px;                        border-spacing: 0px;                        width: 100%;                        margin-top: 2rem;                        width: calc(340px);                        padding: 0;                      "                    >                      <tbody>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                          "                        >                          <td                            align="center"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            padding: 5;                            border-radius: 2%;                            "                          >                                                          <p                                style="                                  font-family: helvetica, sans-serif;                                  text-decoration: none;                                  color: #383838;                                  font-size: 13px;                                  opacity: 0.7;                                  line-height: 1.5rem;                                  margin: 0;                                  padding: 0;                                "                              >                              You are receiving this notification because you set your account settings to notify you. You can always <span style="font-weight: bold;">turn off</span> this on your <span style="font-weight: bold;">account settings</span></p>                                                            </p>                          </td>                        </tr>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                            padding: 0;                          "                        >                          <td                            align="center"                            width="50"                            height="50"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            "                          >                            <img                              src="https://cdn.discordapp.com/attachments/955281529481883729/1020135329635774494/pig.png"                              alt="hero-image"                              width="40"                              height="40"                            />                          </td>                        </tr>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                          "                        >                          <td                            align="center"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            padding: 5;                            border-radius: 2%;                            "                          >                                                          <p                              class="text-col font-lato"                                style="                                  text-decoration: none;                                  font-size: 13px;                                  opacity : 0.7;                                  font-weight: 500;                                  color : #333333;                                  margin: 0;                                  padding: 0;                                "                              >                              PHS System â€¢ OLFU QC,  Philippines</p>                                                            </p>                          </td>                        </tr>                                                                      </tbody>                    </table>                </center>            </div>        </div>    </center>  </body></html>',
  },
  {
    template_name: "RemindMaintinance.html",
    html: '<!DOCTYPE html><html lang="en">  <head>    <meta charset="UTF-8" />    <meta http-equiv="X-UA-Compatible" content="IE=edge" />    <meta name="viewport" content="width=device-width, initial-scale=1.0" />    <title>Document</title>    <style>        .font-lato {            font-family: \'Lato\', sans-serif;        }        .font-montserrat{            font-family: \'Montserrat\', sans-serif        }        .text-col{             color : #473766        }        .justify{            text-align: justify;        }    </style>    <link    href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap"    rel="stylesheet"    type="text/css"  />  <link    href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap"    rel="stylesheet"    type="text/css"  />  </head>  <body style="background-color: rgb(249, 244, 251);">    <center>        <div style="background-color: white; padding : 1rem; border-radius: 1rem; width: calc(560px);">            <div style="background-color: rgb(247, 249, 250); padding:1rem; border-radius: 1rem; width : calc(520px);">                <table        cellpadding="0"        cellspacing="0"        border="0"        width="100%"        style="          width: calc(500px);          border-radius: 1rem;          border-collapse: collapse;          margin: 0 auto;          background-color: white;          padding: 0;          overflow: hidden;        "      >        <tbody>          <tr style="border-collapse: collapse; margin: 0; padding: 0">            <td              width="100%"              style="border-collapse: collapse; margin: 0; padding: 0"            >              <table                width="100%"                cellpadding="0"                cellspacing="0"                border="0"                style="                  min-width: 100%;                  border-collapse: collapse;                  margin: 0;                  padding: 0;                "              >                <tbody>                  <tr style="font-family: helvetica, sans-serif;                  font-weight: 100;                  text-decoration: none;                  color: #333333;                  font-size: 24px;                  border-collapse: collapse; margin: 0; padding: 0">                    <td                      width="100%"                      style="                        min-width: 100%;                        border-collapse: collapse;                        margin: 0;                        padding: 0;                      "                    >                        <div style="margin: 0px 0px 30px 0px">                            <div style="margin: 0px 0px 30px 0px">                                <img src="https://cdn.discordapp.com/attachments/955281529481883729/1020181526136225862/Pink_And_Green_Simple_Gradient_Email_Marketing_Carousel_Instagram_Post_2.png"                                 style="width: 100%;" ></img>                            </div>                            <div style="margin : 0px 20px 0px 20px">                                <p class="text-col font-lato" style="font-size: 1.5rem; font-weight: bold; "><span style="font-weight: lighter;">Hi</span> ${user_name}</p>                            <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">Today is day for the monthly maintinance & checking of your PHS system <span style="font-weight : 900"> ${server_name} @ ${ip} (${url})</span>. You can read the full details about maintinance and checking of the system in the manual provided in your PHS web. </p>                            </div>                        </div>                                          </td>                  </tr>                </tbody>              </table>            </td>          </tr>        </tbody>                </table>                <center>                    <table                      cellpadding="0"                      cellspacing="0"                      style="                        border-collapse: collapse;                        font-size: 13px;                        font-family: helvetica, sans-serif;                        line-height: 30px;                        border-spacing: 0px;                        width: 100%;                        margin-top: 2rem;                        width: calc(340px);                        padding: 0;                      "                    >                      <tbody>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                          "                        >                          <td                            align="center"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            padding: 5;                            border-radius: 2%;                            "                          >                                                          <p                                style="                                  font-family: helvetica, sans-serif;                                  text-decoration: none;                                  color: #383838;                                  font-size: 13px;                                  opacity: 0.7;                                  line-height: 1.5rem;                                  margin: 0;                                  padding: 0;                                "                              >                              You are receiving this notification because you set your account settings to notify you. You can always <span style="font-weight: bold;">turn off</span> this on your <span style="font-weight: bold;">account settings</span></p>                                                            </p>                          </td>                        </tr>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                            padding: 0;                          "                        >                          <td                            align="center"                            width="50"                            height="50"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            "                          >                            <img                              src="https://cdn.discordapp.com/attachments/955281529481883729/1020135329635774494/pig.png"                              alt="hero-image"                              width="40"                              height="40"                            />                          </td>                        </tr>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                          "                        >                          <td                            align="center"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            padding: 5;                            border-radius: 2%;                            "                          >                                                          <p                              class="text-col font-lato"                                style="                                  text-decoration: none;                                  font-size: 13px;                                  opacity : 0.7;                                  font-weight: 500;                                  color : #333333;                                  margin: 0;                                  padding: 0;                                "                              >                              PHS System â€¢ OLFU QC,  Philippines</p>                                                            </p>                          </td>                        </tr>                                                                      </tbody>                    </table>                </center>            </div>        </div>    </center>  </body></html>',
  },
  {
    template_name: "ResetAlert.html",
    html: '<!DOCTYPE html><html lang="en">  <head>    <meta charset="UTF-8" />    <meta http-equiv="X-UA-Compatible" content="IE=edge" />    <meta name="viewport" content="width=device-width, initial-scale=1.0" />    <title>Document</title>    <style>        .font-lato {            font-family: \'Lato\', sans-serif;        }        .font-montserrat{            font-family: \'Montserrat\', sans-serif        }        .text-col{             color : #473766        }        .justify{            text-align: justify;        }    </style>    <link    href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap"    rel="stylesheet"    type="text/css"  />  <link    href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap"    rel="stylesheet"    type="text/css"  />  </head>  <body style="background-color: rgb(249, 244, 251);">    <center>        <div style="background-color: white; padding : 1rem; border-radius: 1rem; width: calc(560px);">            <div style="background-color: rgb(247, 249, 250); padding:1rem; border-radius: 1rem; width : calc(520px);">                <table        cellpadding="0"        cellspacing="0"        border="0"        width="100%"        style="          width: calc(500px);          border-radius: 1rem;          border-collapse: collapse;          margin: 0 auto;          background-color: white;          padding: 0;          overflow: hidden;        "      >        <tbody>          <tr style="border-collapse: collapse; margin: 0; padding: 0">            <td              width="100%"              style="border-collapse: collapse; margin: 0; padding: 0"            >              <table                width="100%"                cellpadding="0"                cellspacing="0"                border="0"                style="                  min-width: 100%;                  border-collapse: collapse;                  margin: 0;                  padding: 0;                "              >                <tbody>                  <tr style="font-family: helvetica, sans-serif;                  font-weight: 100;                  text-decoration: none;                  color: #333333;                  font-size: 24px;                  border-collapse: collapse; margin: 0; padding: 0">                    <td                      width="100%"                      style="                        min-width: 100%;                        border-collapse: collapse;                        margin: 0;                        padding: 0;                      "                    >                        <div style="margin: 0px 0px 30px 0px">                            <div style="margin: 0px 0px 30px 0px">                                <img src="https://cdn.discordapp.com/attachments/955281529481883729/1020168109497258005/Pink_And_Green_Simple_Gradient_Email_Marketing_Carousel_Instagram_Post_3.png"                                 style="width: 100%;" ></img>                            </div>                            <div style="margin : 0px 20px 0px 20px">                                <p class="text-col font-lato" style="font-size: 1.5rem; font-weight: bold; "><span style="font-weight: lighter;">System Reset</p>                                <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">The phs system <span style="font-weight : 900"> ${server_name} @ ${ip} (${url})</span> has been reset to factory default. The affected configuration/settings are the following : <span style="font-weight : 900; font-style: italic;">${reset_content}</span>.</p>                                <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 900; margin-top : 2rem"> Performed By : <span style="font-weight: 500;">${user_name}</span> <br> User ID : <span style="font-weight: 500;">${user_id}</span> <br> Event Date & Time : <span style="font-weight: 500;">${time_string}</span> </p>                            </div>                        </div>                    </td>                  </tr>                </tbody>              </table>            </td>          </tr>        </tbody>                </table>                <center>                    <table                      cellpadding="0"                      cellspacing="0"                      style="                        border-collapse: collapse;                        font-size: 13px;                        font-family: helvetica, sans-serif;                        line-height: 30px;                        border-spacing: 0px;                        width: 100%;                        margin-top: 2rem;                        width: calc(340px);                        padding: 0;                      "                    >                      <tbody>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                          "                        >                          <td                            align="center"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            padding: 5;                            border-radius: 2%;                            "                          >                                                          <p                                style="                                  font-family: helvetica, sans-serif;                                  text-decoration: none;                                  color: #383838;                                  font-size: 13px;                                  opacity: 0.7;                                  line-height: 1.5rem;                                  margin: 0;                                  padding: 0;                                "                              >                              You are receiving this notification because you set your account settings to notify you. You can always <span style="font-weight: bold;">turn off</span> this on your <span style="font-weight: bold;">account settings</span></p>                                                            </p>                          </td>                        </tr>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                            padding: 0;                          "                        >                          <td                            align="center"                            width="50"                            height="50"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            "                          >                            <img                              src="https://cdn.discordapp.com/attachments/955281529481883729/1020135329635774494/pig.png"                              alt="hero-image"                              width="40"                              height="40"                            />                          </td>                        </tr>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                          "                        >                          <td                            align="center"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            padding: 5;                            border-radius: 2%;                            "                          >                                                          <p                              class="text-col font-lato"                                style="                                  text-decoration: none;                                  font-size: 13px;                                  opacity : 0.7;                                  font-weight: 500;                                  color : #333333;                                  margin: 0;                                  padding: 0;                                "                              >                              PHS System â€¢ OLFU QC,  Philippines</p>                                                            </p>                          </td>                        </tr>                                                                      </tbody>                    </table>                </center>            </div>        </div>    </center>  </body></html>',
  },
  {
    template_name: "StorageAlert.html",
    html: '<!DOCTYPE html><html lang="en">  <head>    <meta charset="UTF-8" />    <meta http-equiv="X-UA-Compatible" content="IE=edge" />    <meta name="viewport" content="width=device-width, initial-scale=1.0" />    <title>Document</title>    <style>        .font-lato {            font-family: \'Lato\', sans-serif;        }        .font-montserrat{            font-family: \'Montserrat\', sans-serif        }        .text-col{             color : #473766        }        .justify{            text-align: justify;        }    </style>    <link    href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap"    rel="stylesheet"    type="text/css"  />  <link    href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap"    rel="stylesheet"    type="text/css"  />  </head>  <body style="background-color: rgb(249, 244, 251);">    <center>        <div style="background-color: white; padding : 1rem; border-radius: 1rem; width: calc(560px);">            <div style="background-color: rgb(247, 249, 250); padding:1rem; border-radius: 1rem; width : calc(520px);">                <table        cellpadding="0"        cellspacing="0"        border="0"        width="100%"        style="          width: calc(500px);          border-radius: 1rem;          border-collapse: collapse;          margin: 0 auto;          background-color: white;          padding: 0;          overflow: hidden;        "      >        <tbody>          <tr style="border-collapse: collapse; margin: 0; padding: 0">            <td              width="100%"              style="border-collapse: collapse; margin: 0; padding: 0"            >              <table                width="100%"                cellpadding="0"                cellspacing="0"                border="0"                style="                  min-width: 100%;                  border-collapse: collapse;                  margin: 0;                  padding: 0;                "              >                <tbody>                  <tr style="font-family: helvetica, sans-serif;                  font-weight: 100;                  text-decoration: none;                  color: #333333;                  font-size: 24px;                  border-collapse: collapse; margin: 0; padding: 0">                    <td                      width="100%"                      style="                        min-width: 100%;                        border-collapse: collapse;                        margin: 0;                        padding: 0;                      "                    >                        <div style="margin: 0px 0px 30px 0px">                            <div style="margin: 0px 0px 30px 0px">                                <img src="https://cdn.discordapp.com/attachments/955281529481883729/1020173510087294996/Pink_And_Green_Simple_Gradient_Email_Marketing_Carousel_Instagram_Post_5.png"                                 style="width: 100%;" ></img>                            </div>                            <div style="margin : 0px 20px 0px 20px">                                <p class="text-col font-lato" style="font-size: 1.5rem; font-weight: bold; color : rgb(197, 61, 61) "><span style="font-weight: lighter;">Warning</p>                                <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">The PHS system <span style="font-weight : 900"> ${server_name} @ ${ip} (${url})</span> will not save records & raw data anymore, Please delete old records to free up space.</p>                                <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 900;">Storage Used : <span style="font-weight: 500;">${used_storage} Gb (${percentage_storage} %)</span> <br> Total Storage : <span style="font-weight: 500;">${total_storage_size} Gb</span></p>                                <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">These are the possible things you can do to free up some space.</p>                                <ul>                                    <li>                                        <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">Delete detection records at detection page</p>                                    </li>                                    <li>                                        <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">Reset only detection raw datas</p>                                    </li>                                    <li>                                        <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">Reset only Error & System logs </p>                                    </li>                                    <li>                                        <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">Reset only Export datas</p>                                    </li>                                    <li>                                        <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">Reset only User Photos</p>                                    </li>                                    <li>                                        <p class="text-col  font-monsterrat justify" style="font-size: 1rem; line-height: 2rem; font-weight: 500;">Reset All (delete all data & restore to factory default)</p>                                    </li>                                </ul>                            </div>                        </div>                    </td>                  </tr>                </tbody>              </table>            </td>          </tr>        </tbody>                </table>                <center>                    <table                      cellpadding="0"                      cellspacing="0"                      style="                        border-collapse: collapse;                        font-size: 13px;                        font-family: helvetica, sans-serif;                        line-height: 30px;                        border-spacing: 0px;                        width: 100%;                        margin-top: 2rem;                        width: calc(340px);                        padding: 0;                      "                    >                      <tbody>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                          "                        >                          <td                            align="center"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            padding: 5;                            border-radius: 2%;                            "                          >                                                          <p                                style="                                  font-family: helvetica, sans-serif;                                  text-decoration: none;                                  color: #383838;                                  font-size: 13px;                                  opacity: 0.7;                                  line-height: 1.5rem;                                  margin: 0;                                  padding: 0;                                "                              >                              You are receiving this notification because you set your account settings to notify you. You can always <span style="font-weight: bold;">turn off</span> this on your <span style="font-weight: bold;">account settings</span></p>                                                            </p>                          </td>                        </tr>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                            padding: 0;                          "                        >                          <td                            align="center"                            width="50"                            height="50"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            "                          >                            <img                              src="https://cdn.discordapp.com/attachments/955281529481883729/1020135329635774494/pig.png"                              alt="hero-image"                              width="40"                              height="40"                            />                          </td>                        </tr>                        <tr                          style="                            border-collapse: collapse;                            margin: 0;                          "                        >                          <td                            align="center"                            style="                              border-collapse: collapse;                              margin: 0;                              padding: 0;                            padding: 5;                            border-radius: 2%;                            "                          >                                                          <p                              class="text-col font-lato"                                style="                                  text-decoration: none;                                  font-size: 13px;                                  opacity : 0.7;                                  font-weight: 500;                                  color : #333333;                                  margin: 0;                                  padding: 0;                                "                              >                              PHS System â€¢ OLFU QC,  Philippines</p>                                                            </p>                          </td>                        </tr>                                                                      </tbody>                    </table>                </center>            </div>        </div>    </center>  </body></html>',
  },
];

const getTemplate = (template_name) => {
  let toreturn = "";
  templates.forEach((tmps) => {
    if (tmps.template_name === template_name) toreturn = tmps.html;
  });
  return toreturn;
};

const transTemplate = (template_content) => {
  var template = require("es6-template-strings");
  return template(
    /*getFileContent(template_content)*/ getTemplate(
      template_content.template_name
    ),
    { ...template_content }
  );
};

const sendEmail = async (userEmail, template_content) => {
  /**
   * user_email : string
   * template_content : {
   *  template_name : string
   *  ...other content
   * }
   */

  let smtpTransport = nodeEmailer.createTransport({
    service: "Gmail",
    port: 465,
    auth: {
      user: process.env.MASTEREMAIL,
      pass: process.env.MASTERPASSW,
    },
  });

  let mailOptions = {
    from: process.env.MASTEREMAIL,
    to: userEmail,
    subject: template_content.subject,
    html: transTemplate(template_content),
  };

  try {
    let result = await smtpTransport.sendMail(
      mailOptions,
      (error, response) => {
        if (error) {
          logger.error(`Email Not Sent -> ${mailOptions.to}`);
          logger.error(e.stack);
          console.log("error ", error);
        } else {
          logger.info(`Email Sent -> ${mailOptions.to}`);
        }
      }
    );
  } catch (e) {
    console.log(e);
  }

  smtpTransport.close();
};

module.exports = sendEmail;
